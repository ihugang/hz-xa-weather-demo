<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©æ°”é¢„æŠ¥ - æ­å· & è¥¿å®‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            padding: 30px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #636e72;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.5rem;
            color: #2d3436;
        }

        .error {
            text-align: center;
            padding: 50px;
            font-size: 1.5rem;
            color: #d63031;
        }

        .weather-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .city-weather {
            background: linear-gradient(to bottom right, #74b9ff, #a29bfe);
            border-radius: 10px;
            padding: 20px;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .city-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .city-logo {
            vertical-align: middle;
            border-radius: 4px;
            margin-right: 8px;
        }

        .day-weather {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }

        .day-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .temperature {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .weather-info {
            margin: 3px 0;
            font-size: 0.95rem;
        }

        .navigation {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-button {
            padding: 12px 24px;
            background: #74b9ff;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .nav-button:hover {
            background: #0984e3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .language-toggle {
            margin-top: 15px;
        }

        .language-btn {
            padding: 8px 16px;
            background: #636e72;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        .language-btn.active {
            background: #00b894;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .weather-container {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-button {
                width: 80%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å¤©æ°”é¢„æŠ¥</h1>
            <div class="subtitle">æ­å· & è¥¿å®‰ ä»Šæ˜ä¸¤æ—¥å¤©æ°”</div>
        </header>

        <div id="loading" class="loading">
            æ­£åœ¨è·å–å¤©æ°”æ•°æ®...
        </div>

        <div id="error" class="error" style="display: none;">
            æ— æ³•è·å–å¤©æ°”æ•°æ®ï¼Œè¯·ç¨åé‡è¯•
        </div>

        <div id="content" style="display: none;">
            <div class="weather-container">
                <!-- æ­å·å¤©æ°” -->
                <div class="city-weather">
                    <div class="city-name"><img src="./images/hangzhou-logo.png" alt="æ­å·" class="city-logo" width="30" height="30">æ­å·</div>
                    
                    <!-- ä»Šå¤©å¤©æ°” -->
                    <div class="day-weather">
                        <div class="day-title">Today ä»Šå¤©</div>
                        <div id="hangzhou-today-temp" class="temperature">--Â°C</div>
                        <div id="hangzhou-today-condition" class="weather-info">å¤©æ°”: --</div>
                        <div id="hangzhou-today-humidity" class="weather-info">æ¹¿åº¦: --%</div>
                        <div id="hangzhou-today-wind" class="weather-info">é£é€Ÿ: -- km/h</div>
                    </div>
                    
                    <!-- æ˜å¤©å¤©æ°” -->
                    <div class="day-weather">
                        <div class="day-title">Tomorrow æ˜å¤©</div>
                        <div id="hangzhou-tomorrow-temp" class="temperature">--Â°C</div>
                        <div id="hangzhou-tomorrow-condition" class="weather-info">å¤©æ°”: --</div>
                        <div id="hangzhou-tomorrow-humidity" class="weather-info">æ¹¿åº¦: --%</div>
                        <div id="hangzhou-tomorrow-wind" class="weather-info">é£é€Ÿ: -- km/h</div>
                    </div>
                </div>

                <!-- è¥¿å®‰å¤©æ°” -->
                <div class="city-weather">
                    <div class="city-name"><img src="./images/xian-logo.png" alt="è¥¿å®‰" class="city-logo" width="30" height="30">è¥¿å®‰</div>
                    
                    <!-- ä»Šå¤©å¤©æ°” -->
                    <div class="day-weather">
                        <div class="day-title">Today ä»Šå¤©</div>
                        <div id="xian-today-temp" class="temperature">--Â°C</div>
                        <div id="xian-today-condition" class="weather-info">å¤©æ°”: --</div>
                        <div id="xian-today-humidity" class="weather-info">æ¹¿åº¦: --%</div>
                        <div id="xian-today-wind" class="weather-info">é£é€Ÿ: -- km/h</div>
                    </div>
                    
                    <!-- æ˜å¤©å¤©æ°” -->
                    <div class="day-weather">
                        <div class="day-title">Tomorrow æ˜å¤©</div>
                        <div id="xian-tomorrow-temp" class="temperature">--Â°C</div>
                        <div id="xian-tomorrow-condition" class="weather-info">å¤©æ°”: --</div>
                        <div id="xian-tomorrow-humidity" class="weather-info">æ¹¿åº¦: --%</div>
                        <div id="xian-tomorrow-wind" class="weather-info">é£é€Ÿ: -- km/h</div>
                    </div>
                </div>
            </div>

            <div class="navigation">
                <div class="nav-buttons">
                    <a href="weather_forecast_chinese.html" class="nav-button">è¯¦ç»†é¢„æŠ¥ (15æ—¥)</a>
                </div>
                
                <div class="language-toggle">
                    <button class="language-btn active" onclick="switchLanguage('zh')">ä¸­æ–‡</button>
                    <button class="language-btn" onclick="switchLanguage('en')">English</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä½¿ç”¨ OpenWeatherMap API è·å–çœŸå®å¤©æ°”æ•°æ®
        const API_KEY = '2383424dfab9f6d2a52467e80d0a89d9'; // ä½¿ç”¨æ‚¨æä¾›çš„APIå¯†é’¥
        const API_URL = 'https://api.openweathermap.org/data/2.5';

        // åŸå¸‚åæ ‡
        const cities = {
            hangzhou: { name: 'æ­å·', lat: 30.2741, lon: 120.1551 },
            xian: { name: 'è¥¿å®‰', lat: 34.3416, lon: 108.9398 }
        };

        // å°†å¤©æ°”ä»£ç è½¬æ¢ä¸ºä¸­æ–‡æè¿°
        function getWeatherDescription(weatherCode, mainWeather) {
            const descriptions = {
                'Thunderstorm': 'é›·é˜µé›¨',
                'Drizzle': 'æ¯›æ¯›é›¨',
                'Rain': 'é›¨',
                'Snow': 'é›ª',
                'Clear': 'æ™´å¤©',
                'Clouds': 'å¤šäº‘',
                'Mist': 'è–„é›¾',
                'Smoke': 'çƒŸé›¾',
                'Haze': 'éœ¾',
                'Dust': 'å°˜åœŸ',
                'Fog': 'é›¾',
                'Sand': 'æ²™å°˜',
                'Ash': 'ç«å±±ç°',
                'Squall': 'é£‘çº¿',
                'Tornado': 'é¾™å·é£'
            };
            
            // æ ¹æ®å¤©æ°”ä»£ç è¿”å›æè¿°
            if (weatherCode >= 200 && weatherCode < 300) return 'é›·é˜µé›¨';
            if (weatherCode >= 300 && weatherCode < 400) return 'æ¯›æ¯›é›¨';
            if (weatherCode >= 500 && weatherCode < 600) return 'é›¨';
            if (weatherCode >= 600 && weatherCode < 700) return 'é›ª';
            if (weatherCode >= 700 && weatherCode < 800) return descriptions[mainWeather] || 'ç‰¹æ®Šå¤©æ°”';
            if (weatherCode === 800) return 'æ™´å¤©';
            if (weatherCode > 800 && weatherCode < 900) return 'å¤šäº‘';
            
            return 'æœªçŸ¥å¤©æ°”';
        }

        // è·å–åŸå¸‚å¤©æ°”æ•°æ®
        async function getCityWeather(cityKey) {
            const city = cities[cityKey];
            try {
                // è·å–å½“å‰å¤©æ°”
                const currentResponse = await fetch(
                    `${API_URL}/weather?lat=${city.lat}&lon=${city.lon}&appid=${API_KEY}&units=metric&lang=zh_cn`
                );
                const currentData = await currentResponse.json();

                // è·å–5å¤©é¢„æŠ¥æ•°æ®ï¼ˆæ¯3å°æ—¶ä¸€æ¬¡ï¼‰
                const forecastResponse = await fetch(
                    `${API_URL}/forecast?lat=${city.lat}&lon=${city.lon}&appid=${API_KEY}&units=metric&lang=zh_cn`
                );
                const forecastData = await forecastResponse.json();

                return {
                    current: currentData,
                    forecast: forecastData
                };
            } catch (error) {
                console.error(`è·å–${city.name}å¤©æ°”æ•°æ®æ—¶å‡ºé”™:`, error);
                return null;
            }
        }

        // æ›´æ–°å¤©æ°”æ•°æ®æ˜¾ç¤º
        function updateWeatherDisplay(hangzhouData, xianData) {
            // æ›´æ–°æ­å·å¤©æ°”
            if (hangzhouData) {
                document.getElementById('hangzhou-today-temp').textContent = 
                    `${Math.round(hangzhouData.current.main.temp)}Â°C ${getWeatherIcon(hangzhouData.current.weather[0].icon)}`;
                document.getElementById('hangzhou-today-condition').textContent = 
                    `å¤©æ°”: ${getWeatherDescription(hangzhouData.current.weather[0].id, hangzhouData.current.weather[0].main)}`;
                document.getElementById('hangzhou-today-humidity').textContent = 
                    `æ¹¿åº¦: ${hangzhouData.current.main.humidity}%`;
                document.getElementById('hangzhou-today-wind').textContent = 
                    `é£é€Ÿ: ${Math.round(hangzhouData.current.wind.speed * 3.6)} km/h`;

                // è·å–æ˜å¤©çš„å¤©æ°”é¢„æŠ¥
                const tomorrowForecast = getNextDayForecast(hangzhouData.forecast.list);
                if (tomorrowForecast) {
                    document.getElementById('hangzhou-tomorrow-temp').textContent = 
                        `${Math.round(tomorrowForecast.temp)}Â°C ${getWeatherIcon(tomorrowForecast.icon)}`;
                    document.getElementById('hangzhou-tomorrow-condition').textContent = 
                        `å¤©æ°”: ${getWeatherDescription(tomorrowForecast.code, tomorrowForecast.main)}`;
                    document.getElementById('hangzhou-tomorrow-humidity').textContent = 
                        `æ¹¿åº¦: ${tomorrowForecast.humidity}%`;
                    document.getElementById('hangzhou-tomorrow-wind').textContent = 
                        `é£é€Ÿ: ${Math.round(tomorrowForecast.windSpeed * 3.6)} km/h`;
                }
            }

            // æ›´æ–°è¥¿å®‰å¤©æ°”
            if (xianData) {
                document.getElementById('xian-today-temp').textContent = 
                    `${Math.round(xianData.current.main.temp)}Â°C ${getWeatherIcon(xianData.current.weather[0].icon)}`;
                document.getElementById('xian-today-condition').textContent = 
                    `å¤©æ°”: ${getWeatherDescription(xianData.current.weather[0].id, xianData.current.weather[0].main)}`;
                document.getElementById('xian-today-humidity').textContent = 
                    `æ¹¿åº¦: ${xianData.current.main.humidity}%`;
                document.getElementById('xian-today-wind').textContent = 
                    `é£é€Ÿ: ${Math.round(xianData.current.wind.speed * 3.6)} km/h`;

                // è·å–æ˜å¤©çš„å¤©æ°”é¢„æŠ¥
                const tomorrowForecast = getNextDayForecast(xianData.forecast.list);
                if (tomorrowForecast) {
                    document.getElementById('xian-tomorrow-temp').textContent = 
                        `${Math.round(tomorrowForecast.temp)}Â°C ${getWeatherIcon(tomorrowForecast.icon)}`;
                    document.getElementById('xian-tomorrow-condition').textContent = 
                        `å¤©æ°”: ${getWeatherDescription(tomorrowForecast.code, tomorrowForecast.main)}`;
                    document.getElementById('xian-tomorrow-humidity').textContent = 
                        `æ¹¿åº¦: ${tomorrowForecast.humidity}%`;
                    document.getElementById('xian-tomorrow-wind').textContent = 
                        `é£é€Ÿ: ${Math.round(tomorrowForecast.windSpeed * 3.6)} km/h`;
                }
            }
        }

        // è·å–æ˜å¤©çš„å¤©æ°”é¢„æŠ¥
        function getNextDayForecast(forecasts) {
            const today = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(today.getDate() + 1);
            
            // æŸ¥æ‰¾æ˜å¤©çš„é¢„æŠ¥æ•°æ®
            const tomorrowForecasts = forecasts.filter(forecast => {
                const forecastDate = new Date(forecast.dt * 1000);
                return forecastDate.getDate() === tomorrow.getDate() && 
                       forecastDate.getMonth() === tomorrow.getMonth();
            });

            if (tomorrowForecasts.length > 0) {
                // è®¡ç®—å¹³å‡æ¸©åº¦å’Œå…¶ä»–æŒ‡æ ‡
                const temps = tomorrowForecasts.map(f => f.main.temp);
                const avgTemp = temps.reduce((a, b) => a + b, 0) / temps.length;
                
                // ä½¿ç”¨ç¬¬ä¸€ä¸ªé¢„æŠ¥çš„æ•°æ®ä½œä¸ºä»£è¡¨
                const representative = tomorrowForecasts[0];
                
                return {
                    temp: avgTemp,
                    code: representative.weather[0].id,
                    main: representative.weather[0].main,
                    humidity: representative.main.humidity,
                    windSpeed: representative.wind.speed,
                    icon: representative.weather[0].icon
                };
            }
            
            return null;
        }

        // æ ¹æ®å¤©æ°”å›¾æ ‡ä»£ç è¿”å›emoji
        function getWeatherIcon(iconCode) {
            // æ ¹æ®OpenWeatherMapçš„å›¾æ ‡ä»£ç è¿”å›ç›¸åº”çš„emoji
            if (iconCode.includes('01d') || iconCode.includes('01n')) return 'â˜€ï¸'; // Clear
            if (iconCode.includes('02d') || iconCode.includes('02n')) return 'ğŸŒ¤ï¸'; // Few clouds
            if (iconCode.includes('03d') || iconCode.includes('03n')) return 'â˜ï¸'; // Scattered clouds
            if (iconCode.includes('04d') || iconCode.includes('04n')) return 'â˜ï¸'; // Broken clouds
            if (iconCode.includes('09d') || iconCode.includes('09n')) return 'ğŸŒ§ï¸'; // Shower rain
            if (iconCode.includes('10d') || iconCode.includes('10n')) return 'ğŸŒ¦ï¸'; // Rain
            if (iconCode.includes('11d') || iconCode.includes('11n')) return 'â›ˆï¸'; // Thunderstorm
            if (iconCode.includes('13d') || iconCode.includes('13n')) return 'â„ï¸'; // Snow
            if (iconCode.includes('50d') || iconCode.includes('50n')) return 'ğŸŒ«ï¸'; // Mist
            
            return 'ğŸŒ¤ï¸';
        }

        // åŠ è½½å¤©æ°”æ•°æ®
        async function loadWeatherData() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('content').style.display = 'none';
                document.getElementById('error').style.display = 'none';

                // å¹¶è¡Œè·å–ä¸¤ä¸ªåŸå¸‚çš„å¤©æ°”æ•°æ®
                const [hangzhouData, xianData] = await Promise.all([
                    getCityWeather('hangzhou'),
                    getCityWeather('xian')
                ]);

                // æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®
                if (!hangzhouData || !xianData) {
                    throw new Error('æ— æ³•è·å–å¤©æ°”æ•°æ®');
                }

                // æ›´æ–°æ˜¾ç¤º
                updateWeatherDisplay(hangzhouData, xianData);

                // éšè—åŠ è½½æŒ‡ç¤ºå™¨ï¼Œæ˜¾ç¤ºå†…å®¹
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (error) {
                console.error('åŠ è½½å¤©æ°”æ•°æ®æ—¶å‡ºé”™:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }

        // è¯­è¨€åˆ‡æ¢åŠŸèƒ½
        function switchLanguage(lang) {
            const buttons = document.querySelectorAll('.language-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if(lang === 'zh') {
                document.querySelector('.subtitle').textContent = 'æ­å· & è¥¿å®‰ ä»Šæ˜ä¸¤æ—¥å¤©æ°”';
                document.querySelector('.city-name:nth-child(1)').innerHTML = 'ğŸ™ï¸ æ­å·';
                document.querySelector('.city-name:nth-child(2)').innerHTML = 'ğŸ›ï¸ è¥¿å®‰';
                document.querySelector('.day-title:nth-child(1)').textContent = 'Today ä»Šå¤©';
                document.querySelector('.day-title:nth-child(4)').textContent = 'Tomorrow æ˜å¤©';
                document.querySelector('.day-title:nth-child(6)').textContent = 'Today ä»Šå¤©';
                document.querySelector('.day-title:nth-child(9)').textContent = 'Tomorrow æ˜å¤©';
                document.querySelector('.nav-button:nth-child(1)').textContent = 'è¯¦ç»†é¢„æŠ¥ (15æ—¥)';
                document.querySelector('.language-btn:first-child').classList.add('active');
            } else {
                document.querySelector('.subtitle').textContent = 'Hangzhou & Xi\'an Next Two Days Weather';
                document.querySelector('.city-name:nth-child(1)').innerHTML = 'ğŸ™ï¸ Hangzhou';
                document.querySelector('.city-name:nth-child(2)').innerHTML = 'ğŸ›ï¸ Xi\'an';
                document.querySelector('.day-title:nth-child(1)').textContent = 'ä»Šå¤© Today';
                document.querySelector('.day-title:nth-child(4)').textContent = 'æ˜å¤© Tomorrow';
                document.querySelector('.day-title:nth-child(6)').textContent = 'ä»Šå¤© Today';
                document.querySelector('.day-title:nth-child(9)').textContent = 'æ˜å¤© Tomorrow';
                document.querySelector('.nav-button:nth-child(1)').textContent = 'Detailed Forecast (15-day)';
                document.querySelector('.language-btn:last-child').classList.add('active');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè·å–å¤©æ°”æ•°æ®
        document.addEventListener('DOMContentLoaded', loadWeatherData);
    </script>
</body>
</html>